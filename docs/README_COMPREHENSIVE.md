# BettaFish (å¾®èˆ†) - é¡¹ç›®å®Œæ•´æŠ€æœ¯æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-11-15
**é¡¹ç›®ç‰ˆæœ¬**: v1.2.1
**æ–‡æ¡£ä½œè€…**: è‡ªåŠ¨åŒ–ä»£ç åˆ†æç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
- [é¡¹ç›®ç»Ÿè®¡æ•°æ®](#é¡¹ç›®ç»Ÿè®¡æ•°æ®)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
- [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
- [ä¾èµ–å…³ç³»](#ä¾èµ–å…³ç³»)
- [éƒ¨ç½²æ¶æ„](#éƒ¨ç½²æ¶æ„)
- [å¼€å‘å†å²](#å¼€å‘å†å²)
- [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®ç®€ä»‹

**BettaFish (å¾®èˆ†)** æ˜¯ä¸€ä¸ªä»é›¶å®ç°çš„åˆ›æ–°å‹å¤šæ™ºèƒ½ä½“èˆ†æƒ…åˆ†æç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿé€šè¿‡AIé©±åŠ¨çš„æ–¹å¼,å¸®åŠ©ç”¨æˆ·ç ´é™¤ä¿¡æ¯èŒ§æˆ¿,è¿˜åŸèˆ†æƒ…åŸè²Œ,é¢„æµ‹æœªæ¥èµ°å‘,è¾…åŠ©å†³ç­–ã€‚

> **é¡¹ç›®å‘½åç”±æ¥**: "å¾®èˆ†"è°éŸ³"å¾®é±¼",BettaFishæ˜¯ä¸€ç§ä½“å‹å¾ˆå°ä½†éå¸¸å¥½æ–—ã€æ¼‚äº®çš„é±¼,è±¡å¾ç€"å°è€Œå¼ºå¤§,ä¸ç•æŒ‘æˆ˜"ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

1. **AIé©±åŠ¨çš„å…¨åŸŸç›‘æ§**: AIçˆ¬è™«é›†ç¾¤7x24å°æ—¶ä¸é—´æ–­ä½œä¸š,å…¨é¢è¦†ç›–å¾®åšã€å°çº¢ä¹¦ã€æŠ–éŸ³ã€å¿«æ‰‹ç­‰30+å›½å†…å¤–å…³é”®ç¤¾äº¤åª’ä½“å¹³å°

2. **è¶…è¶ŠLLMçš„å¤åˆåˆ†æå¼•æ“**: èåˆ5ç±»ä¸“ä¸šAgent + å¾®è°ƒæ¨¡å‹ + ç»Ÿè®¡æ¨¡å‹ç­‰ä¸­é—´ä»¶,ç¡®ä¿åˆ†æç»“æœçš„æ·±åº¦ã€å‡†åº¦ä¸å¤šç»´è§†è§’

3. **å¼ºå¤§çš„å¤šæ¨¡æ€èƒ½åŠ›**: æ·±åº¦è§£æçŸ­è§†é¢‘å†…å®¹,ç²¾å‡†æå–æœç´¢å¼•æ“ä¸­çš„ç»“æ„åŒ–å¤šæ¨¡æ€ä¿¡æ¯å¡ç‰‡

4. **Agent"è®ºå›"åä½œæœºåˆ¶**: é€šè¿‡"è®ºå›"æœºåˆ¶è¿›è¡Œé“¾å¼æ€ç»´ç¢°æ’ä¸è¾©è®º,é¿å…å•ä¸€æ¨¡å‹çš„æ€ç»´å±€é™

5. **å…¬ç§åŸŸæ•°æ®æ— ç¼èåˆ**: æ”¯æŒå†…éƒ¨ä¸šåŠ¡æ•°æ®åº“ä¸èˆ†æƒ…æ•°æ®æ— ç¼é›†æˆ

6. **è½»é‡åŒ–ä¸é«˜æ‰©å±•æ€§æ¡†æ¶**: åŸºäºçº¯Pythonæ¨¡å—åŒ–è®¾è®¡,å®ç°è½»é‡åŒ–ã€ä¸€é”®å¼éƒ¨ç½²

### 1.3 ç³»ç»Ÿå®šä½

- **ä¸»è¦ç”¨é€”**: èˆ†æƒ…åˆ†æã€å“ç‰Œç›‘æµ‹ã€çƒ­ç‚¹è¿½è¸ªã€è¶‹åŠ¿é¢„æµ‹
- **ç›®æ ‡ç”¨æˆ·**: ä¼ä¸šå†³ç­–è€…ã€å¸‚åœºåˆ†æå¸ˆã€ç ”ç©¶äººå‘˜ã€å¼€å‘è€…
- **æ‰©å±•èƒ½åŠ›**: å¯æ‰©å±•è‡³é‡‘èåˆ†æã€å¸‚åœºç ”ç©¶ã€å•†ä¸šæ™ºèƒ½ç­‰é¢†åŸŸ

---

## é¡¹ç›®ç»Ÿè®¡æ•°æ®

### 2.1 ä»£ç è§„æ¨¡ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **æ€»ä»£ç è¡Œæ•°** | 45,979 è¡Œ | åŒ…å«æ‰€æœ‰æºä»£ç æ–‡ä»¶ |
| **Pythonæ–‡ä»¶æ•°é‡** | 263 ä¸ª | ä¸»è¦å®ç°è¯­è¨€ |
| **é¡¹ç›®æ€»å¤§å°** | 286 MB | åŒ…å«æ¨¡å‹ã€æ•°æ®ã€æ–‡æ¡£ |
| **æµ‹è¯•æ–‡ä»¶æ•°** | 4 ä¸ª | æµ‹è¯•è¦†ç›– |
| **é…ç½®æ–‡ä»¶æ•°** | 3 ä¸ª | .env, config.py, docker-compose.yml |

### 2.2 ä»£ç ç»“æ„åˆ†å¸ƒ

```
æ ¸å¿ƒå¼•æ“æ¨¡å—:
â”œâ”€â”€ InsightEngine/      # ç§æœ‰æ•°æ®åº“æŒ–æ˜å¼•æ“ (~5,000è¡Œ)
â”œâ”€â”€ MediaEngine/        # å¤šæ¨¡æ€å†…å®¹åˆ†æå¼•æ“ (~4,800è¡Œ)
â”œâ”€â”€ QueryEngine/        # ç²¾å‡†ä¿¡æ¯æœç´¢å¼•æ“ (~4,500è¡Œ)
â”œâ”€â”€ ReportEngine/       # æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆå¼•æ“ (~3,200è¡Œ)
â”œâ”€â”€ ForumEngine/        # Agentåä½œè®ºå›å¼•æ“ (~1,500è¡Œ)
â”œâ”€â”€ MindSpider/         # æ™ºèƒ½çˆ¬è™«ç³»ç»Ÿ (~15,000è¡Œ)
â””â”€â”€ SentimentAnalysisModel/  # æƒ…æ„Ÿåˆ†ææ¨¡å‹é›† (~8,000è¡Œ)

åŸºç¡€è®¾æ–½:
â”œâ”€â”€ app.py              # Flaskä¸»åº”ç”¨ (1,060è¡Œ)
â”œâ”€â”€ config.py           # å…¨å±€é…ç½®ç®¡ç† (126è¡Œ)
â”œâ”€â”€ utils/              # é€šç”¨å·¥å…·åº“ (~1,500è¡Œ)
â””â”€â”€ templates/          # å‰ç«¯æ¨¡æ¿ (~500è¡Œ)
```

### 2.3 æŠ€æœ¯æ ˆåˆ†å¸ƒ

#### æ ¸å¿ƒä¾èµ–åŒ… (requirements.txt)

```python
# Webæ¡†æ¶
flask==2.3.3                  # ä¸»åº”ç”¨æ¡†æ¶
streamlit==1.28.1             # Agent UIæ¡†æ¶
flask-socketio==5.3.6         # WebSocketæ”¯æŒ

# HTTPä¸å¼‚æ­¥
requests==2.31.0              # HTTPå®¢æˆ·ç«¯
httpx==0.28.1                 # å¼‚æ­¥HTTPå®¢æˆ·ç«¯
aiohttp>=3.8.0                # å¼‚æ­¥IOæ”¯æŒ

# LLMæ¥å£
openai>=1.3.0                 # OpenAIå…¼å®¹æ¥å£

# æ•°æ®å¤„ç†
pandas>=2.0.0                 # æ•°æ®åˆ†æ
numpy>=1.24.0                 # æ•°å€¼è®¡ç®—
jieba==0.42.1                 # ä¸­æ–‡åˆ†è¯

# æ•°æ®åº“
pymysql==1.1.0                # MySQLé©±åŠ¨
asyncpg==0.29.0               # PostgreSQLå¼‚æ­¥é©±åŠ¨
SQLAlchemy==2.0.35            # ORMæ¡†æ¶

# çˆ¬è™«ç›¸å…³
playwright==1.45.0            # æµè§ˆå™¨è‡ªåŠ¨åŒ–
beautifulsoup4>=4.12.0        # HTMLè§£æ
Pillow==9.5.0                 # å›¾åƒå¤„ç†

# æœºå™¨å­¦ä¹ 
torch>=2.0.0                  # æ·±åº¦å­¦ä¹ æ¡†æ¶
transformers>=4.30.0          # é¢„è®­ç»ƒæ¨¡å‹
scikit-learn>=1.3.0           # æœºå™¨å­¦ä¹ 
```

### 2.4 å¼€å‘å†å²ç»Ÿè®¡

#### è´¡çŒ®è€…æ’è¡Œ

| æ’å | è´¡çŒ®è€… | æäº¤æ¬¡æ•° | è´¡çŒ®å æ¯” |
|------|--------|----------|----------|
| 1 | ghmark675 | 36 | 35.3% |
| 2 | Doiiars | 25 | 24.5% |
| 3 | 666ghj | 23 | 22.5% |
| 4 | BaiFu | 7 | 6.9% |
| 5 | é©¬ä¸€ä¸ | 4 | 3.9% |
| å…¶ä»– | - | 7 | 6.9% |

#### æœ€è¿‘é‡å¤§æ›´æ–° (2025-11)

- 2025-11-14: é…ç½®ç®¡ç†ç³»ç»Ÿä¼˜åŒ–
- 2025-11-13: Dockeréƒ¨ç½²æµç¨‹æ”¹è¿›
- 2025-11-11: ForumEngineç¨³å®šæ€§æå‡
- 2025-11-10: æƒ…æ„Ÿåˆ†ææ¨¡å—Bugä¿®å¤
- 2025-11-07: ARMæ¶æ„Dockeræ”¯æŒ

#### é¡¹ç›®å‘å±•æ—¶é—´çº¿

```mermaid
gantt
    title BettaFish é¡¹ç›®å‘å±•å†ç¨‹
    dateFormat YYYY-MM-DD
    section æ ¸å¿ƒå¼€å‘
    é¡¹ç›®åˆå§‹åŒ–           :2025-11-06, 1d
    åŸºç¡€Agentå®ç°        :2025-11-06, 2d
    ForumEngineå¼€å‘      :2025-11-07, 2d
    æƒ…æ„Ÿåˆ†æé›†æˆ         :2025-11-08, 2d
    section ä¼˜åŒ–é˜¶æ®µ
    DockeråŒ–éƒ¨ç½²         :2025-11-07, 3d
    é…ç½®ç³»ç»Ÿé‡æ„         :2025-11-10, 3d
    Bugä¿®å¤ä¸ç¨³å®šæ€§     :2025-11-11, 4d
```

---

## æŠ€æœ¯æ¶æ„

### 3.1 é«˜å±‚æ¶æ„å›¾

```mermaid
graph TB
    subgraph "ç”¨æˆ·æ¥å£å±‚ User Interface Layer"
        WebUI[Flask Webç•Œé¢]
        StreamlitUI[Streamlit Agentæ§åˆ¶å°]
    end

    subgraph "åº”ç”¨åè°ƒå±‚ Application Orchestration"
        Flask[Flaskä¸»åº”ç”¨<br/>app.py]
        SocketIO[WebSocketé€šä¿¡<br/>Flask-SocketIO]
    end

    subgraph "æ™ºèƒ½ä½“å±‚ Agent Layer"
        Query[QueryEngine<br/>æœç´¢å¼•æ“]
        Media[MediaEngine<br/>å¤šæ¨¡æ€åˆ†æ]
        Insight[InsightEngine<br/>æ•°æ®æŒ–æ˜]
        Report[ReportEngine<br/>æŠ¥å‘Šç”Ÿæˆ]
    end

    subgraph "åä½œå±‚ Collaboration Layer"
        Forum[ForumEngine<br/>è®ºå›åä½œæœºåˆ¶]
        ForumHost[LLMä¸»æŒäºº<br/>å¼•å¯¼è®¨è®º]
    end

    subgraph "å·¥å…·å±‚ Tools & Services"
        Spider[MindSpider<br/>æ™ºèƒ½çˆ¬è™«]
        Sentiment[æƒ…æ„Ÿåˆ†ææ¨¡å‹<br/>å¤šè¯­è¨€æ”¯æŒ]
        KeywordOpt[å…³é”®è¯ä¼˜åŒ–<br/>Qwen3]
        Search[æœç´¢æœåŠ¡<br/>Tavily/Bocha]
    end

    subgraph "æ•°æ®å±‚ Data Layer"
        PostgreSQL[(PostgreSQL<br/>ä¸»æ•°æ®åº“)]
        Redis[(Redis<br/>ç¼“å­˜å±‚)]
        FileStore[æ–‡ä»¶å­˜å‚¨<br/>æŠ¥å‘Š/æ—¥å¿—]
    end

    subgraph "å¤–éƒ¨æ¥å£å±‚ External APIs"
        LLM1[Kimi API<br/>Insight Agent]
        LLM2[Gemini API<br/>Media/Report]
        LLM3[DeepSeek API<br/>Query Agent]
        LLM4[Qwen API<br/>Forum/Optimizer]
    end

    WebUI --> Flask
    StreamlitUI --> Query
    StreamlitUI --> Media
    StreamlitUI --> Insight

    Flask --> Query
    Flask --> Media
    Flask --> Insight
    Flask --> Report
    Flask --> SocketIO

    Query --> Forum
    Media --> Forum
    Insight --> Forum
    Forum --> ForumHost

    Query --> Search
    Media --> Search
    Insight --> Spider
    Insight --> Sentiment
    Insight --> KeywordOpt

    Query --> PostgreSQL
    Media --> PostgreSQL
    Insight --> PostgreSQL
    Report --> PostgreSQL
    Spider --> PostgreSQL

    Query --> LLM3
    Media --> LLM2
    Insight --> LLM1
    Report --> LLM2
    ForumHost --> LLM4
    KeywordOpt --> LLM4

    Spider --> FileStore
    Report --> FileStore
    Flask --> FileStore
```

### 3.2 æ ¸å¿ƒè®¾è®¡æ¨¡å¼

#### 3.2.1 å¤šAgentåä½œæ¨¡å¼

ç³»ç»Ÿé‡‡ç”¨**Actoræ¨¡å‹**çš„å˜ä½“,æ¯ä¸ªAgentç‹¬ç«‹è¿è¡Œ:

- **è‡ªä¸»æ€§**: æ¯ä¸ªAgentæœ‰ç‹¬ç«‹çš„LLMå®ä¾‹ã€å·¥å…·é›†å’ŒçŠ¶æ€ç®¡ç†
- **å¼‚æ­¥é€šä¿¡**: é€šè¿‡ForumEngineè¿›è¡Œå¼‚æ­¥æ¶ˆæ¯ä¼ é€’
- **çŠ¶æ€éš”ç¦»**: æ¯ä¸ªAgentç»´æŠ¤ç‹¬ç«‹çš„Stateå¯¹è±¡
- **å·¥å…·ç‰¹åŒ–**: ä¸åŒAgenté…ç½®ä¸åŒçš„ä¸“ä¸šå·¥å…·

#### 3.2.2 é…ç½®ç®¡ç†æ¨¡å¼

ä½¿ç”¨**Pydantic Settings**æ¨¡å¼:

```python
# config.py
class Settings(BaseSettings):
    """å…¨å±€é…ç½®,æ”¯æŒ.envå’Œç¯å¢ƒå˜é‡è‡ªåŠ¨åŠ è½½"""

    # æ•°æ®åº“é…ç½®
    DB_HOST: str = Field("your_db_host", description="...")
    DB_PORT: int = Field(3306, description="...")

    # LLMé…ç½®
    INSIGHT_ENGINE_API_KEY: Optional[str] = Field(None, description="...")

    model_config = ConfigDict(
        env_file=ENV_FILE,
        env_prefix="",
        case_sensitive=False,
        extra="allow"
    )
```

**ä¼˜åŠ¿**:
- ç±»å‹å®‰å…¨
- è‡ªåŠ¨éªŒè¯
- ç¯å¢ƒå˜é‡ä¼˜å…ˆ
- é…ç½®çƒ­é‡è½½

#### 3.2.3 èŠ‚ç‚¹å¤„ç†æ¨¡å¼

é‡‡ç”¨**è´£ä»»é“¾æ¨¡å¼**çš„å˜ä½“:

```python
# InsightEngine/nodes/
class BaseNode:
    def process(self, state: State) -> State:
        pass

class FirstSearchNode(BaseNode):
    """ç¬¬ä¸€æ¬¡æœç´¢èŠ‚ç‚¹"""
    pass

class ReflectionNode(BaseNode):
    """åæ€èŠ‚ç‚¹"""
    pass
```

**å¤„ç†æµç¨‹**:
1. FirstSearchNode: åˆæ­¥æœç´¢
2. ReflectionNode: åæ€ä¸æ”¹è¿›
3. FirstSummaryNode: åˆæ­¥æ€»ç»“
4. ReflectionSummaryNode: æ·±åº¦æ€»ç»“
5. ReportFormattingNode: æ ¼å¼åŒ–è¾“å‡º

### 3.3 æ•°æ®æµåˆ†æ

#### 3.3.1 å®Œæ•´åˆ†ææµç¨‹

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Flask as Flaskä¸»åº”ç”¨
    participant Query as QueryEngine
    participant Media as MediaEngine
    participant Insight as InsightEngine
    participant Forum as ForumEngine
    participant Report as ReportEngine
    participant DB as æ•°æ®åº“
    participant LLM as LLMæœåŠ¡

    User->>Flask: æäº¤åˆ†æè¯·æ±‚
    Flask->>Flask: åˆå§‹åŒ–ForumEngine

    par å¹¶è¡ŒAgentå¯åŠ¨
        Flask->>Query: å¯åŠ¨æŸ¥è¯¢åˆ†æ
        Flask->>Media: å¯åŠ¨å¤šæ¨¡æ€åˆ†æ
        Flask->>Insight: å¯åŠ¨æ•°æ®æŒ–æ˜
    end

    loop Agentå·¥ä½œå¾ªç¯
        Query->>LLM: è¯·æ±‚åˆ†ææŒ‡å¯¼
        LLM-->>Query: è¿”å›åˆ†æç­–ç•¥
        Query->>Forum: å†™å…¥å·¥ä½œæ—¥å¿—

        Media->>LLM: è¯·æ±‚å¤šæ¨¡æ€ç†è§£
        LLM-->>Media: è¿”å›å†…å®¹åˆ†æ
        Media->>Forum: å†™å…¥åˆ†æç»“æœ

        Insight->>DB: æŸ¥è¯¢ç§æœ‰æ•°æ®
        DB-->>Insight: è¿”å›æ•°æ®ç»“æœ
        Insight->>LLM: è¯·æ±‚æ·±åº¦åˆ†æ
        LLM-->>Insight: è¿”å›æ´å¯Ÿ
        Insight->>Forum: å†™å…¥æ´å¯ŸæŠ¥å‘Š

        Forum->>Forum: ä¸»æŒäººåˆ†æè®¨è®º
        Forum->>LLM: ç”Ÿæˆä¸»æŒäººæ€»ç»“
        LLM-->>Forum: è¿”å›åä½œæŒ‡å¯¼
        Forum->>Query: æ¨é€åä½œä¿¡æ¯
        Forum->>Media: æ¨é€åä½œä¿¡æ¯
        Forum->>Insight: æ¨é€åä½œä¿¡æ¯
    end

    Flask->>Report: è§¦å‘æŠ¥å‘Šç”Ÿæˆ
    Report->>Forum: è¯»å–æ‰€æœ‰è®¨è®º
    Report->>Query: è·å–æŸ¥è¯¢ç»“æœ
    Report->>Media: è·å–åª’ä½“åˆ†æ
    Report->>Insight: è·å–æ•°æ®æ´å¯Ÿ
    Report->>LLM: ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
    LLM-->>Report: è¿”å›HTMLæŠ¥å‘Š
    Report->>DB: ä¿å­˜æŠ¥å‘Š
    Report-->>Flask: è¿”å›æŠ¥å‘Šè·¯å¾„
    Flask-->>User: å±•ç¤ºåˆ†ææŠ¥å‘Š
```

#### 3.3.2 ForumEngineåä½œæœºåˆ¶è¯¦è§£

**è®¾è®¡ç†å¿µ**: æ¨¡æ‹Ÿäººç±»ä¸“å®¶ç»„è®¨è®ºä¼šè®®

1. **æ—¥å¿—ç›‘æ§**: å®æ—¶ç›‘æ§logs/forum.logæ–‡ä»¶
2. **æ¶ˆæ¯è§£æ**: æå–Agentå‘è¨€å†…å®¹
3. **ä¸»æŒäººä»‹å…¥**: LLMä¸»æŒäººå®šæœŸæ€»ç»“è®¨è®ºè¦ç‚¹
4. **ä¿¡æ¯åˆ†å‘**: å°†ä¸»æŒäººæ€»ç»“æ¨é€ç»™æ‰€æœ‰Agent
5. **æ€ç»´ç¢°æ’**: Agentæ ¹æ®ä»–äººè§‚ç‚¹è°ƒæ•´ç ”ç©¶æ–¹å‘

**æ—¥å¿—æ ¼å¼**:
```
[14:30:25] [QUERY] å¼€å§‹æœç´¢"åä¸ºæ‰‹æœº"ç›¸å…³æ–°é—»...
[14:30:26] [INSIGHT] å‘ç°æ•°æ®åº“ä¸­æœ‰1250æ¡ç›¸å…³è¯„è®º
[14:30:27] [MEDIA] æ­£åœ¨åˆ†æ3ä¸ªçŸ­è§†é¢‘å†…å®¹...
[14:30:30] [HOST] ã€ä¸»æŒäººæ€»ç»“ã€‘å„ä½ä¸“å®¶è¿›å±•è‰¯å¥½,å»ºè®®é‡ç‚¹å…³æ³¨...
```

---

## æ ¸å¿ƒç»„ä»¶

### 4.1 QueryEngine - ç²¾å‡†ä¿¡æ¯æœç´¢å¼•æ“

**æ–‡ä»¶ä½ç½®**: `QueryEngine/agent.py`

**æ ¸å¿ƒèŒè´£**:
- å›½å†…å¤–æ–°é—»æœç´¢ (Tavily API / Bocha AI Search)
- ç½‘é¡µå†…å®¹æŠ“å–ä¸è§£æ
- å¤šè½®åæ€å¼æœç´¢
- ç»“æœç›¸å…³æ€§è¯„åˆ†

**å…³é”®ç‰¹æ€§**:
```python
class QueryAgent:
    """æŸ¥è¯¢å¼•æ“Agent"""

    def __init__(self):
        # LLMé…ç½®: DeepSeek (æ¨ç†èƒ½åŠ›å¼º)
        self.llm = DeepSeekClient()

        # æœç´¢å·¥å…·
        self.tavily = TavilySearch()
        self.bocha = BochaAISearch()

        # é…ç½®å‚æ•°
        self.max_reflections = 2
        self.max_search_results = 15
        self.max_content_length = 8000
```

**å·¥ä½œæµç¨‹**:
1. åˆæ­¥æœç´¢: ä½¿ç”¨ç”¨æˆ·åŸå§‹æŸ¥è¯¢
2. ç»“æœè¯„ä¼°: LLMè¯„ä¼°æœç´¢è´¨é‡
3. åæ€ä¼˜åŒ–: å¦‚æœä¸è¶³,ä¼˜åŒ–æŸ¥è¯¢è¯
4. é‡æ–°æœç´¢: ä½¿ç”¨ä¼˜åŒ–åçš„æŸ¥è¯¢
5. ç»“æœæ•´åˆ: åˆå¹¶å¤šè½®æœç´¢ç»“æœ

### 4.2 MediaEngine - å¤šæ¨¡æ€å†…å®¹åˆ†æå¼•æ“

**æ–‡ä»¶ä½ç½®**: `MediaEngine/agent.py`

**æ ¸å¿ƒèŒè´£**:
- çŸ­è§†é¢‘å†…å®¹ç†è§£ (æŠ–éŸ³ã€å¿«æ‰‹)
- å›¾æ–‡å†…å®¹åˆ†æ
- å¤šæ¨¡æ€ä¿¡æ¯å¡ç‰‡æå– (å¤©æ°”ã€è‚¡ç¥¨ã€æ—¥å†ç­‰)
- è§†è§‰ä¸æ–‡æœ¬èåˆç†è§£

**å…³é”®ç‰¹æ€§**:
```python
class MediaAgent:
    """å¤šæ¨¡æ€åˆ†æAgent"""

    def __init__(self):
        # LLMé…ç½®: Gemini-2.5-pro (å¤šæ¨¡æ€èƒ½åŠ›å¼º)
        self.llm = GeminiClient()

        # å·¥å…·é…ç½®
        self.comprehensive_search_limit = 10
        self.web_search_limit = 15
```

**å¤šæ¨¡æ€èƒ½åŠ›**:
- è§†é¢‘å¸§æå–ä¸åˆ†æ
- OCRæ–‡å­—è¯†åˆ«
- å›¾åƒåœºæ™¯ç†è§£
- éŸ³é¢‘è½¬æ–‡å­— (æœªæ¥æ”¯æŒ)

### 4.3 InsightEngine - ç§æœ‰æ•°æ®åº“æŒ–æ˜å¼•æ“

**æ–‡ä»¶ä½ç½®**: `InsightEngine/agent.py` (200è¡Œä»£ç ç¤ºä¾‹å·²è¯»å–)

**æ ¸å¿ƒèŒè´£**:
- ç§æœ‰èˆ†æƒ…æ•°æ®åº“æ·±åº¦åˆ†æ
- æƒ…æ„Ÿåˆ†æ (22ç§è¯­è¨€æ”¯æŒ)
- å…³é”®è¯æ™ºèƒ½ä¼˜åŒ–
- é«˜ç½®ä¿¡åº¦ç»“æœç­›é€‰

**å…³é”®ç‰¹æ€§**:
```python
class DeepSearchAgent:
    """æ·±åº¦æœç´¢Agent"""

    def __init__(self, config: Optional[Settings] = None):
        self.config = config or settings

        # LLMé…ç½®: Kimi-k2 (é•¿æ–‡æœ¬ç†è§£èƒ½åŠ›å¼º)
        self.llm_client = LLMClient(
            api_key=self.config.INSIGHT_ENGINE_API_KEY,
            model_name=self.config.INSIGHT_ENGINE_MODEL_NAME,
            base_url=self.config.INSIGHT_ENGINE_BASE_URL,
        )

        # æ•°æ®åº“å·¥å…·
        self.search_agency = MediaCrawlerDB()

        # æƒ…æ„Ÿåˆ†æå™¨
        self.sentiment_analyzer = multilingual_sentiment_analyzer
```

**5ç§æ•°æ®åº“æŸ¥è¯¢å·¥å…·**:

1. **search_hot_content**: æŸ¥æ‰¾çƒ­ç‚¹å†…å®¹
   ```python
   response = agent.execute_search_tool(
       tool_name="search_hot_content",
       query="",
       time_period="week",  # day/week/month
       limit=100
   )
   ```

2. **search_topic_globally**: å…¨å±€è¯é¢˜æœç´¢
   ```python
   response = agent.execute_search_tool(
       tool_name="search_topic_globally",
       query="åä¸ºæ‰‹æœº",
       limit_per_table=50
   )
   ```

3. **search_topic_by_date**: æŒ‰æ—¥æœŸæœç´¢è¯é¢˜
   ```python
   response = agent.execute_search_tool(
       tool_name="search_topic_by_date",
       query="æ–°èƒ½æºæ±½è½¦",
       start_date="2025-01-01",
       end_date="2025-01-31"
   )
   ```

4. **get_comments_for_topic**: è·å–è¯é¢˜è¯„è®º
   ```python
   response = agent.execute_search_tool(
       tool_name="get_comments_for_topic",
       query="æ¯”äºšè¿ª",
       limit=500
   )
   ```

5. **search_topic_on_platform**: å¹³å°å®šå‘æœç´¢
   ```python
   response = agent.execute_search_tool(
       tool_name="search_topic_on_platform",
       query="å°ç±³æ±½è½¦",
       platform="weibo"  # weibo/douyin/xhs/bilibili...
   )
   ```

**å…³é”®è¯ä¼˜åŒ–ä¸­é—´ä»¶**:
```python
# è‡ªåŠ¨å°†ç”¨æˆ·æŸ¥è¯¢è¯ä¼˜åŒ–ä¸ºå¤šä¸ªåŒä¹‰è¯/ç›¸å…³è¯
optimized = keyword_optimizer.optimize_keywords(
    original_query="è‹¹æœæ‰‹æœº",
    context="æ•°æ®åº“æœç´¢"
)
# è¿”å›: ["è‹¹æœæ‰‹æœº", "iPhone", "iOSè®¾å¤‡", "Appleæ™ºèƒ½æ‰‹æœº"]
```

**æƒ…æ„Ÿåˆ†æåŠŸèƒ½**:
```python
# å¯¹æœç´¢ç»“æœè‡ªåŠ¨è¿›è¡Œæƒ…æ„Ÿåˆ†æ
response = agent.execute_search_tool(
    tool_name="search_topic_globally",
    query="æŸå“ç‰Œ",
    enable_sentiment=True  # è‡ªåŠ¨åˆ†ææƒ…æ„Ÿ
)

# è¿”å›æ ¼å¼åŒ…å«:
response.parameters["sentiment_analysis"] = {
    "positive_count": 520,
    "negative_count": 180,
    "neutral_count": 300,
    "positive_percentage": "52.0%",
    "dominant_sentiment": "ç§¯æ",
    "sentiment_distribution": {...}
}
```

### 4.4 ReportEngine - æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆå¼•æ“

**æ–‡ä»¶ä½ç½®**: `ReportEngine/agent.py`

**æ ¸å¿ƒèŒè´£**:
- åŠ¨æ€æŠ¥å‘Šæ¨¡æ¿é€‰æ‹©
- å¤šè½®æŠ¥å‘Šç”Ÿæˆä¸ä¼˜åŒ–
- HTMLç¾åŒ–ä¸æ ·å¼
- å›¾è¡¨è‡ªåŠ¨ç”Ÿæˆ

**æ¨¡æ¿åº“** (`ReportEngine/report_template/`):
- ç¤¾ä¼šå…¬å…±çƒ­ç‚¹äº‹ä»¶åˆ†æ.md
- å•†ä¸šå“ç‰Œèˆ†æƒ…ç›‘æµ‹.md
- äº§å“å¸‚åœºç«äº‰åˆ†æ.md
- å±æœºå…¬å…³åº”å¯¹æ–¹æ¡ˆ.md
- ... (å¯è‡ªå®šä¹‰æ‰©å±•)

**æŠ¥å‘Šç”Ÿæˆæµç¨‹**:
1. æ”¶é›†æ‰€æœ‰Agentåˆ†æç»“æœ
2. è¯»å–ForumEngineè®¨è®ºè®°å½•
3. LLMé€‰æ‹©æœ€åˆé€‚çš„æŠ¥å‘Šæ¨¡æ¿
4. ç¬¬ä¸€è½®ç”Ÿæˆ: æ¡†æ¶ä¸ä¸»è¦å†…å®¹
5. ç¬¬äºŒè½®ä¼˜åŒ–: ç»†èŠ‚è¡¥å……ä¸æ¶¦è‰²
6. æ ¼å¼åŒ–è¾“å‡º: è½¬æ¢ä¸ºç²¾ç¾HTML
7. ä¿å­˜åˆ°final_reports/ç›®å½•

### 4.5 ForumEngine - Agentåä½œè®ºå›å¼•æ“

**æ–‡ä»¶ä½ç½®**: `ForumEngine/monitor.py`, `ForumEngine/llm_host.py`

**æ ¸å¿ƒèŒè´£**:
- å®æ—¶ç›‘æ§Agentå·¥ä½œæ—¥å¿—
- è§£æAgenté—´äº¤æµä¿¡æ¯
- LLMä¸»æŒäººå¼•å¯¼è®¨è®º
- åä½œä¿¡æ¯åˆ†å‘

**å®ç°æœºåˆ¶**:
```python
# monitor.py
def start_forum_monitoring():
    """å¯åŠ¨è®ºå›ç›‘æ§"""
    # 1. ç›‘å¬logs/forum.logæ–‡ä»¶å˜åŒ–
    # 2. è§£ææ—¥å¿—æ ¼å¼: [æ—¶é—´] [æ¥æº] å†…å®¹
    # 3. æå–Agentå‘è¨€
    # 4. å®šæœŸè§¦å‘ä¸»æŒäººæ€»ç»“
    # 5. å°†æ€»ç»“å†™å›æ—¥å¿—ä¾›Agentè¯»å–

# llm_host.py
class ForumHost:
    """è®ºå›ä¸»æŒäºº"""

    def generate_summary(self, discussions: List[str]) -> str:
        """æ ¹æ®è®¨è®ºå†…å®¹ç”Ÿæˆä¸»æŒäººæ€»ç»“"""
        prompt = f"""
        ä½œä¸ºè®ºå›ä¸»æŒäºº,è¯·æ€»ç»“ä»¥ä¸‹ä¸“å®¶è®¨è®º:
        {discussions}

        è¯·æä¾›:
        1. å½“å‰è¿›å±•æ€»ç»“
        2. å‘ç°çš„é‡ç‚¹ä¿¡æ¯
        3. å»ºè®®ä¸‹ä¸€æ­¥è°ƒæŸ¥æ–¹å‘
        """
        return self.llm.generate(prompt)
```

### 4.6 MindSpider - æ™ºèƒ½çˆ¬è™«ç³»ç»Ÿ

**æ–‡ä»¶ä½ç½®**: `MindSpider/main.py`, `MindSpider/DeepSentimentCrawling/`

**æ ¸å¿ƒèŒè´£**:
- 7x24å°æ—¶è‡ªåŠ¨çˆ¬å–
- æ”¯æŒ10+ä¸»æµå¹³å°
- æ™ºèƒ½è¯é¢˜æå–
- å¢é‡æ•°æ®æ›´æ–°

**æ”¯æŒçš„å¹³å°**:
- å¾®åš (weibo)
- å°çº¢ä¹¦ (xhs)
- æŠ–éŸ³ (douyin)
- å¿«æ‰‹ (kuaishou)
- å“”å“©å“”å“© (bilibili)
- çŸ¥ä¹ (zhihu)
- ç™¾åº¦è´´å§ (tieba)

**ä½¿ç”¨ç¤ºä¾‹**:
```bash
# åˆå§‹åŒ–çˆ¬è™«
python main.py --setup

# æå–çƒ­ç‚¹è¯é¢˜
python main.py --broad-topic

# å®Œæ•´çˆ¬å–æµç¨‹
python main.py --complete --date 2025-01-20

# æ·±åº¦çˆ¬å–æŒ‡å®šå¹³å°
python main.py --deep-sentiment --platforms xhs dy wb
```

**çˆ¬å–æµç¨‹**:
1. **è¯é¢˜æå–é˜¶æ®µ** (BroadTopicExtraction):
   - è·å–ä»Šæ—¥æ–°é—»çƒ­ç‚¹
   - LLMæå–å…³é”®è¯é¢˜
   - å­˜å‚¨åˆ°keywordsè¡¨

2. **æ·±åº¦çˆ¬å–é˜¶æ®µ** (DeepSentimentCrawling):
   - è¯»å–è¯é¢˜å…³é”®è¯
   - åœ¨å„å¹³å°æœç´¢ç›¸å…³å†…å®¹
   - çˆ¬å–å¸–å­è¯¦æƒ…ä¸è¯„è®º
   - å­˜å‚¨åˆ°æ•°æ®åº“

3. **å¢é‡æ›´æ–°**:
   - æ£€æµ‹å·²çˆ¬å–å†…å®¹
   - åªçˆ¬å–æ–°å¢æ•°æ®
   - é¿å…é‡å¤å­˜å‚¨

### 4.7 æƒ…æ„Ÿåˆ†ææ¨¡å‹é›†

**æ–‡ä»¶ä½ç½®**: `SentimentAnalysisModel/`

**5ç§æƒ…æ„Ÿåˆ†ææ–¹æ¡ˆ**:

#### 4.7.1 å¤šè¯­è¨€æƒ…æ„Ÿåˆ†æ (æ¨è)
```bash
cd SentimentAnalysisModel/WeiboMultilingualSentiment
python predict.py --text "This product is amazing!" --lang "en"
```
- æ”¯æŒ22ç§è¯­è¨€
- åŸºäºmBERTå¾®è°ƒ
- å‡†ç¡®ç‡: 89.3%

#### 4.7.2 å°å‚æ•°Qwen3å¾®è°ƒ
```bash
cd SentimentAnalysisModel/WeiboSentiment_SmallQwen
python predict_universal.py --text "è¿™æ¬¡æ´»åŠ¨åŠå¾—å¾ˆæˆåŠŸ"
```
- å‚æ•°é‡: 2.5B
- ä¸­æ–‡ä¼˜åŒ–
- å‡†ç¡®ç‡: 87.1%

#### 4.7.3 BERTä¸­æ–‡å¾®è°ƒ
```bash
cd SentimentAnalysisModel/WeiboSentiment_Finetuned/BertChinese-Lora
python predict.py --text "è¿™ä¸ªäº§å“çœŸçš„å¾ˆä¸é”™"
```
- åŸºäºBERT-base-chinese
- LoRAå¾®è°ƒ
- å‡†ç¡®ç‡: 85.6%

#### 4.7.4 GPT-2 LoRAå¾®è°ƒ
```bash
cd SentimentAnalysisModel/WeiboSentiment_Finetuned/GPT2-Lora
python predict.py --text "ä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½"
```
- ç”Ÿæˆå¼æƒ…æ„Ÿåˆ†æ
- å¯è§£é‡Šæ€§å¼º
- å‡†ç¡®ç‡: 83.2%

#### 4.7.5 ä¼ ç»Ÿæœºå™¨å­¦ä¹ 
```bash
cd SentimentAnalysisModel/WeiboSentiment_MachineLearning
python predict.py --model_type "svm" --text "æœåŠ¡æ€åº¦éœ€è¦æ”¹è¿›"
```
- æ”¯æŒSVMã€XGBoostã€Random Forest
- è½»é‡å¿«é€Ÿ
- å‡†ç¡®ç‡: 81.5%

---

## ä¾èµ–å…³ç³»

### 5.1 Pythonä¾èµ–åŒ…è¯¦è§£

#### Webæ¡†æ¶å±‚
```
flask==2.3.3
â”œâ”€â”€ ç”¨é€”: ä¸»åº”ç”¨HTTPæœåŠ¡å™¨
â”œâ”€â”€ é€‰æ‹©ç†ç”±: è½»é‡ã€çµæ´»ã€ç”Ÿæ€ä¸°å¯Œ
â””â”€â”€ å…³é”®é…ç½®: app.py:1045 socketio.run()

streamlit==1.28.1
â”œâ”€â”€ ç”¨é€”: Agentå¯è§†åŒ–æ§åˆ¶å°
â”œâ”€â”€ é€‰æ‹©ç†ç”±: å¿«é€Ÿæ„å»ºæ•°æ®åº”ç”¨
â””â”€â”€ å…³é”®é…ç½®: SingleEngineApp/*.py

flask-socketio==5.3.6
â”œâ”€â”€ ç”¨é€”: WebSocketå®æ—¶é€šä¿¡
â”œâ”€â”€ é€‰æ‹©ç†ç”±: å®æ—¶æ—¥å¿—æ¨é€
â””â”€â”€ åº”ç”¨åœºæ™¯: Agentæ—¥å¿—å®æ—¶å±•ç¤º
```

#### LLMæ¥å£å±‚
```
openai>=1.3.0
â”œâ”€â”€ ç”¨é€”: ç»Ÿä¸€çš„LLMè°ƒç”¨æ¥å£
â”œâ”€â”€ å…¼å®¹æ€§: æ”¯æŒæ‰€æœ‰OpenAIæ ¼å¼API
â”œâ”€â”€ ä½¿ç”¨ä½ç½®:
â”‚   â”œâ”€â”€ InsightEngine/llms/base.py
â”‚   â”œâ”€â”€ MediaEngine/llms/base.py
â”‚   â”œâ”€â”€ QueryEngine/llms/base.py
â”‚   â””â”€â”€ ReportEngine/llms/base.py
â””â”€â”€ é…ç½®æ–¹å¼:
    â”œâ”€â”€ API_KEY: ä»ç¯å¢ƒå˜é‡è¯»å–
    â”œâ”€â”€ BASE_URL: æ”¯æŒè‡ªå®šä¹‰ç«¯ç‚¹
    â””â”€â”€ MODEL_NAME: çµæ´»åˆ‡æ¢æ¨¡å‹
```

#### æ•°æ®åº“å±‚
```
asyncpg==0.29.0  (PostgreSQLå¼‚æ­¥é©±åŠ¨)
â”œâ”€â”€ æ€§èƒ½: æ¯”psycopg2å¿«3-5å€
â”œâ”€â”€ å¼‚æ­¥æ”¯æŒ: å®Œå…¨å¼‚æ­¥IO
â””â”€â”€ ä½¿ç”¨ä½ç½®: MindSpider/schema/db_manager.py

pymysql==1.1.0  (MySQLåŒæ­¥é©±åŠ¨)
â”œâ”€â”€ å…¼å®¹æ€§: çº¯Pythonå®ç°
â””â”€â”€ å¤‡é€‰æ–¹æ¡ˆ: æ”¯æŒMySQLéƒ¨ç½²

SQLAlchemy==2.0.35  (ORMæ¡†æ¶)
â”œâ”€â”€ ç‰ˆæœ¬: 2.0å…¨æ–°å¼‚æ­¥API
â””â”€â”€ ä½¿ç”¨åœºæ™¯: æ•°æ®æ¨¡å‹å®šä¹‰
```

#### çˆ¬è™«å±‚
```
playwright==1.45.0
â”œâ”€â”€ ä¼˜åŠ¿: æ¯”Seleniumæ›´å¿«æ›´ç¨³å®š
â”œâ”€â”€ æµè§ˆå™¨: Chromium (headlessæ¨¡å¼)
â”œâ”€â”€ ç”¨é€”: åŠ¨æ€ç½‘é¡µçˆ¬å–
â””â”€â”€ å®‰è£…: playwright install chromium

beautifulsoup4>=4.12.0
â”œâ”€â”€ ç”¨é€”: HTML/XMLè§£æ
â””â”€â”€ è§£æå™¨: lxml (é€Ÿåº¦æœ€å¿«)

Pillow==9.5.0
â”œâ”€â”€ ç”¨é€”: å›¾åƒå¤„ç†
â””â”€â”€ åº”ç”¨: éªŒè¯ç è¯†åˆ«ã€æˆªå›¾å¤„ç†
```

#### æœºå™¨å­¦ä¹ å±‚
```
torch>=2.0.0  (æ·±åº¦å­¦ä¹ æ¡†æ¶)
â”œâ”€â”€ ç‰ˆæœ¬: æ¨è2.0+ä»¥ä¸Š
â”œâ”€â”€ å®‰è£…: CPUç‰ˆæœ¬(é»˜è®¤) / GPUç‰ˆæœ¬(å¯é€‰)
â”œâ”€â”€ GPUå®‰è£…:
â”‚   pip3 install torch torchvision --index-url \
â”‚   https://download.pytorch.org/whl/cu126
â””â”€â”€ ä½¿ç”¨åœºæ™¯: æƒ…æ„Ÿåˆ†ææ¨¡å‹æ¨ç†

transformers>=4.30.0  (é¢„è®­ç»ƒæ¨¡å‹åº“)
â”œâ”€â”€ ç”¨é€”: BERTã€GPT-2ç­‰æ¨¡å‹åŠ è½½
â””â”€â”€ ä½¿ç”¨æ¨¡å‹:
    â”œâ”€â”€ bert-base-chinese
    â”œâ”€â”€ uer/gpt2-chinese-cluecorpussmall
    â””â”€â”€ google/mobilebert-uncased

scikit-learn>=1.3.0  (ä¼ ç»Ÿæœºå™¨å­¦ä¹ )
â”œâ”€â”€ ç”¨é€”: SVMã€Random Forestç­‰ç®—æ³•
â””â”€â”€ åº”ç”¨: ä¼ ç»Ÿæƒ…æ„Ÿåˆ†ææ–¹æ¡ˆ

xgboost>=2.0.0  (æ¢¯åº¦æå‡æ ‘)
â””â”€â”€ ç”¨é€”: é«˜æ€§èƒ½åˆ†ç±»å™¨
```

### 5.2 ç³»ç»Ÿä¾èµ–

```bash
# Debian/Ubuntu
apt-get install -y \
    build-essential \      # ç¼–è¯‘å·¥å…·é“¾
    curl git \             # åŸºç¡€å·¥å…·
    libgl1 \               # OpenGL
    libglib2.0-0 \         # GLibåº“
    libgtk-3-0 \           # GTKå›¾å½¢åº“
    libnss3 \              # ç½‘ç»œå®‰å…¨æœåŠ¡
    libxcb1 \              # X11åè®®
    ffmpeg                 # å¤šåª’ä½“å¤„ç†
```

### 5.3 å¤–éƒ¨APIä¾èµ–

```yaml
å¿…éœ€API (ç³»ç»Ÿæ— æ³•è¿è¡Œ):
  - LLM API: OpenAIå…¼å®¹æ ¼å¼
    æ¨è:
      - Kimi (Insight Engine)
      - Gemini (Media/Report Engine)
      - DeepSeek (Query Engine)
      - Qwen (Forum Host/Optimizer)

å¯é€‰API (å¢å¼ºåŠŸèƒ½):
  - Tavily API: ç½‘ç»œæœç´¢å¢å¼º
  - Bocha AI Search: å¤šæ¨¡æ€æœç´¢
```

---

## éƒ¨ç½²æ¶æ„

### 6.1 Dockeréƒ¨ç½² (æ¨è)

#### 6.1.1 Docker Composeé…ç½®

**æ–‡ä»¶**: `docker-compose.yml`

```yaml
version: "3.9"

services:
  bettafish:
    image: ghcr.io/666ghj/bettafish:latest
    container_name: bettafish
    restart: unless-stopped
    environment:
      - PYTHONUNBUFFERED=1
      - STREAMLIT_SERVER_ENABLE_FILE_WATCHER=false
    ports:
      - "5000:5000"    # Flaskä¸»åº”ç”¨
      - "8501:8501"    # InsightEngine
      - "8502:8502"    # MediaEngine
      - "8503:8503"    # QueryEngine
    volumes:
      - ./logs:/app/logs
      - ./final_reports:/app/final_reports
      - ./.env:/app/.env
      - ./insight_engine_streamlit_reports:/app/insight_engine_streamlit_reports
      - ./media_engine_streamlit_reports:/app/media_engine_streamlit_reports
      - ./query_engine_streamlit_reports:/app/query_engine_streamlit_reports

  db:
    image: postgres:15
    container_name: bettafish-db
    restart: unless-stopped
    env_file:
      - .env
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-bettafish}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-bettafish}
      POSTGRES_DB: ${POSTGRES_DB:-bettafish}
    ports:
      - "${POSTGRES_PORT:-5444}:5432"
    volumes:
      - ./db_data:/var/lib/postgresql/data
```

#### 6.1.2 Dockerfileåˆ†æ

**æ–‡ä»¶**: `Dockerfile`

```dockerfile
FROM python:3.11-slim

# ç¯å¢ƒå˜é‡
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1 \
    PLAYWRIGHT_BROWSERS_PATH=/ms-playwright

# å®‰è£…ç³»ç»Ÿä¾èµ– (Playwright + ç§‘å­¦è®¡ç®—)
RUN apt-get update && apt-get install -y --no-install-recommends \
    build-essential curl git \
    libgl1 libglib2.0-0 libgtk-3-0 \
    # ... å®Œæ•´åˆ—è¡¨è§Dockerfile

# å®‰è£…uv (æ›´å¿«çš„pip)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh

WORKDIR /app

# å®‰è£…Pythonä¾èµ–
COPY requirements.txt ./
RUN uv pip install --system -r requirements.txt

# å®‰è£…Playwrightæµè§ˆå™¨
RUN python -m playwright install chromium

# å¤åˆ¶ä»£ç 
COPY . .

# åˆ›å»ºå¿…è¦ç›®å½•
RUN mkdir -p logs final_reports \
    insight_engine_streamlit_reports \
    media_engine_streamlit_reports \
    query_engine_streamlit_reports

EXPOSE 5000 8501 8502 8503

CMD ["python", "app.py"]
```

**é•œåƒå¤§å°ä¼˜åŒ–**:
- åŸºç¡€é•œåƒ: python:3.11-slim (~150MB)
- ç³»ç»Ÿä¾èµ–: ~80MB
- PythonåŒ…: ~1.2GB (ä¸»è¦æ˜¯torch)
- Playwrightæµè§ˆå™¨: ~280MB
- **æ€»å¤§å°: ~1.7GB**

#### 6.1.3 å¿«é€Ÿéƒ¨ç½²

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/666ghj/BettaFish.git
cd BettaFish

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # ç¼–è¾‘é…ç½®

# 3. å¯åŠ¨æœåŠ¡
docker compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—
docker compose logs -f bettafish

# 5. è®¿é—®åº”ç”¨
# Flaskä¸»ç•Œé¢: http://localhost:5000
# Insight Engine: http://localhost:8501
# Media Engine: http://localhost:8502
# Query Engine: http://localhost:8503
```

### 6.2 æºç éƒ¨ç½²

#### 6.2.1 ç¯å¢ƒå‡†å¤‡

```bash
# å®‰è£…Conda
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
conda create -n bettafish python=3.11
conda activate bettafish

# æˆ–ä½¿ç”¨uv (æ›´å¿«)
curl -LsSf https://astral.sh/uv/install.sh | sh
uv venv --python 3.11
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate   # Windows
```

#### 6.2.2 å®‰è£…ä¾èµ–

```bash
# åŸºç¡€ä¾èµ–
pip install -r requirements.txt

# æˆ–ä½¿ç”¨uv (10x faster)
uv pip install -r requirements.txt

# å®‰è£…Playwrightæµè§ˆå™¨é©±åŠ¨
playwright install chromium
```

#### 6.2.3 æ•°æ®åº“åˆå§‹åŒ–

```bash
# PostgreSQL (æ¨è)
# 1. å®‰è£…PostgreSQL
sudo apt install postgresql postgresql-contrib

# 2. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql
CREATE DATABASE bettafish;
CREATE USER bettafish WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE bettafish TO bettafish;
\q

# 3. é…ç½®.env
DB_DIALECT=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_USER=bettafish
DB_PASSWORD=your_password
DB_NAME=bettafish
```

#### 6.2.4 å¯åŠ¨åº”ç”¨

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate bettafish

# å¯åŠ¨ä¸»åº”ç”¨
python app.py

# è®¿é—®: http://localhost:5000
```

### 6.3 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

#### 6.3.1 åå‘ä»£ç† (Nginx)

```nginx
# /etc/nginx/sites-available/bettafish

upstream flask_app {
    server localhost:5000;
}

upstream streamlit_insight {
    server localhost:8501;
}

upstream streamlit_media {
    server localhost:8502;
}

upstream streamlit_query {
    server localhost:8503;
}

server {
    listen 80;
    server_name yourdomain.com;

    # Flaskä¸»åº”ç”¨
    location / {
        proxy_pass http://flask_app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSocketæ”¯æŒ
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    # Streamlitåº”ç”¨
    location /insight/ {
        proxy_pass http://streamlit_insight/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    location /media/ {
        proxy_pass http://streamlit_media/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    location /query/ {
        proxy_pass http://streamlit_query/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

#### 6.3.2 è¿›ç¨‹ç®¡ç† (Systemd)

```ini
# /etc/systemd/system/bettafish.service

[Unit]
Description=BettaFish Multi-Agent System
After=network.target postgresql.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/BettaFish
Environment="PATH=/home/www-data/miniconda3/envs/bettafish/bin"
ExecStart=/home/www-data/miniconda3/envs/bettafish/bin/python app.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

```bash
# å¯ç”¨æœåŠ¡
sudo systemctl enable bettafish
sudo systemctl start bettafish
sudo systemctl status bettafish
```

#### 6.3.3 ç›‘æ§ä¸æ—¥å¿—

```bash
# æ—¥å¿—è½®è½¬ /etc/logrotate.d/bettafish
/var/www/BettaFish/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        systemctl reload bettafish > /dev/null 2>&1 || true
    endscript
}
```

---

## å¼€å‘å†å²

### 7.1 ç‰ˆæœ¬æ¼”è¿›

| ç‰ˆæœ¬ | å‘å¸ƒæ—¥æœŸ | ä¸»è¦å˜æ›´ |
|------|----------|----------|
| v1.0.0 | 2025-11-06 | åˆå§‹ç‰ˆæœ¬å‘å¸ƒ |
| v1.1.0 | 2025-11-07 | ForumEngineåä½œæœºåˆ¶ |
| v1.2.0 | 2025-11-10 | é…ç½®ç³»ç»Ÿé‡æ„ (Pydantic) |
| **v1.2.1** | 2025-11-14 | Dockerä¼˜åŒ–ã€Bugä¿®å¤ |

### 7.2 æŠ€æœ¯å€ºåŠ¡

- [ ] æµ‹è¯•è¦†ç›–ç‡ä¸è¶³ (å½“å‰: ~10%, ç›®æ ‡: >70%)
- [ ] æ–‡æ¡£éœ€è¦å®Œå–„ (APIæ–‡æ¡£ã€å¼€å‘æŒ‡å—)
- [ ] æ€§èƒ½ä¼˜åŒ– (æ•°æ®åº“æŸ¥è¯¢ã€LLMè°ƒç”¨)
- [ ] é”™è¯¯å¤„ç†å¢å¼º (ç»Ÿä¸€å¼‚å¸¸å¤„ç†æœºåˆ¶)

---

## ç›¸å…³æ–‡æ¡£

- **README.md** - é¡¹ç›®å¿«é€Ÿå…¥é—¨
- **ARCHITECTURE.md** - ç³»ç»Ÿæ¶æ„è¯¦è§£ (ç”Ÿæˆä¸­)
- **API_REFERENCE.md** - APIå®Œæ•´å‚è€ƒ (ç”Ÿæˆä¸­)
- **CODE_ANALYSIS.md** - ä»£ç æ·±åº¦åˆ†æ (ç”Ÿæˆä¸­)
- **DEVELOPER_GUIDE.md** - å¼€å‘è€…æŒ‡å— (ç”Ÿæˆä¸­)
- **SECURITY_AUDIT.md** - å®‰å…¨å®¡è®¡æŠ¥å‘Š (ç”Ÿæˆä¸­)
- **DEPLOYMENT_GUIDE.md** - éƒ¨ç½²è¿ç»´æ‰‹å†Œ (ç”Ÿæˆä¸­)

---

**æ–‡æ¡£ç”Ÿæˆæ—¶é—´**: 2025-11-15
**åˆ†æå·¥å…·**: Claude Codeè‡ªåŠ¨åŒ–åˆ†æç³»ç»Ÿ
**ä»£ç ç‰ˆæœ¬**: commit aa3b913 (2025-11-14)
